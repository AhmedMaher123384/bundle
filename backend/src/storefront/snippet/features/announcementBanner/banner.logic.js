module.exports = [
  "(function(){",
  "var g=null;try{g=globalThis}catch(e){g=window}if(!g)g=window;",
  "g.BundleApp=g.BundleApp||{};",
  "var debug=false;try{debug=new URL(scriptSrc).searchParams.get(\"debug\")===\"1\"}catch(e){}",
  "function warn(){if(!debug)return;try{console.warn.apply(console,arguments)}catch(e){}}",
  "function getBackendOrigin(){try{return new URL(scriptSrc).origin}catch(e){return\"\"}}",
  "function buildUrl(path,params){var origin=getBackendOrigin();if(!origin)return null;var u=new URL(origin+path);for(var k in (params||{})){if(!Object.prototype.hasOwnProperty.call(params,k))continue;var v=params[k];if(v==null||v===\"\")continue;u.searchParams.set(k,String(v))}u.searchParams.set(\"merchantId\",merchantId);u.searchParams.set(\"token\",token);return u.toString()}",
  "async function fetchJson(url){var r=await fetch(url);var t=await r.text();var j=null;try{j=t?JSON.parse(t):null}catch(e){throw new Error(\"Invalid JSON response\")}if(!r.ok){var msg=(j&&j.message)||(\"HTTP \"+r.status);var err=new Error(msg);err.status=r.status;err.details=j;throw err}return j}",
  "function escHtml(input){var s=String(input==null?\"\":input);return s.replace(/[&<>\"']/g,function(ch){return ch===\"&\"?\"&amp;\":ch===\"<\"?\"&lt;\":ch===\">\"?\"&gt;\":ch==='\"'?\"&quot;\":\"&#39;\"})}",
  "function isCartLikePage(){try{var p=String(window.location.pathname||\"\").toLowerCase();return p.indexOf('cart')!==-1||p.indexOf('checkout')!==-1}catch(e){return false}}",
  "function dismissKey(bannerId){return \"bundle_app_announcement_dismissed:\"+String(merchantId||\"\")+\":\"+String(bannerId||\"\")}",
  "function isDismissed(banner){try{if(!banner||!banner.id)return false;var raw=localStorage.getItem(dismissKey(banner.id));if(!raw)return false;var j=null;try{j=JSON.parse(raw)}catch(e){j=null}if(j&&typeof j==='object'){var until=Number(j.until||0);if(Number.isFinite(until)&&until>Date.now())return true;var forever=Boolean(j.forever);if(forever)return true}return raw===\"1\"}catch(e){return false}}",
  "function setDismissed(banner){try{if(!banner||!banner.id)return;var ttl=Number(banner.dismissTtlHours);if(!Number.isFinite(ttl)||ttl<0)ttl=72;var rec=null;if(ttl===0){rec={forever:true}}else{rec={until:Date.now()+ttl*60*60*1000}}localStorage.setItem(dismissKey(banner.id),JSON.stringify(rec))}catch(e){}}",
  "function removeBanner(){try{var el=document.getElementById('bundle-app-announcement');if(el)el.remove()}catch(e){}}",
  "function pageLang(){try{var el=document&&document.documentElement;var b=document&&document.body;var l=(el&&el.getAttribute&&el.getAttribute('lang'))||(b&&b.getAttribute&&b.getAttribute('lang'))||'';return String(l||'').toLowerCase()}catch(e){return ''}}",
  "function isArabic(){try{var l=pageLang();if(l&&l.indexOf('ar')===0)return true;var nl=String((navigator&&navigator.language)||'').toLowerCase();return nl&&nl.indexOf('ar')===0}catch(e){return false}}",
  "function isRtl(){try{var d=(document&&document.documentElement&&document.documentElement.dir)||'';if(d&&String(d).toLowerCase()==='rtl')return true;var bd=(document&&document.body&&document.body.dir)||'';if(bd&&String(bd).toLowerCase()==='rtl')return true;var cs=window.getComputedStyle?window.getComputedStyle(document.body||document.documentElement):null;var dir=cs&&cs.direction?String(cs.direction).toLowerCase():'';if(dir==='rtl')return true;return isArabic()}catch(e){return false}}",
  "function clampNum(n,min,max,def){var x=Number(n);if(!Number.isFinite(x))return def;return Math.max(min,Math.min(max,x))}",
  "function safeHref(href){try{var s=String(href||'').trim();if(!s)return null;if(s.indexOf('/')===0)return s;var u=new URL(s,window.location.origin);if(u.protocol==='http:'||u.protocol==='https:')return u.toString();return null}catch(e){return null}}",
  "function segmentHtml(b){var title=b&&b.title?String(b.title):'';var msg=b&&b.message?String(b.message):'';var linkUrl=b&&b.linkUrl?String(b.linkUrl):'';var linkText=b&&b.linkText?String(b.linkText):'';var out='';if(title)out+='<strong class=\"bundle-app-announcement__title\">'+escHtml(title)+'</strong>';if(msg)out+='<span class=\"bundle-app-announcement__message\">'+escHtml(msg)+'</span>';if(linkUrl&&linkText)out+='<a class=\"bundle-app-announcement__link\" href=\"'+escHtml(linkUrl)+'\" rel=\"noopener noreferrer\" target=\"_blank\">'+escHtml(linkText)+'</a>';return out}",
  "function setupMarquee(el,banner){try{if(!(banner&&banner.motionEnabled===true))return;var marquee=el.querySelector('.bundle-app-announcement__marquee');var track=el.querySelector('.bundle-app-announcement__track');if(!marquee||!track||!track.children||!track.children.length)return;var seg=track.children[0];var segRect=seg.getBoundingClientRect();var contRect=marquee.getBoundingClientRect();if(!segRect||!contRect)return;var segW=Number(segRect.width||0);var contW=Number(contRect.width||0);if(!(segW>0&&contW>0))return;var cs=window.getComputedStyle?window.getComputedStyle(track):null;var gapRaw=cs&&(cs.columnGap||cs.gap)?String(cs.columnGap||cs.gap):'';var gap=parseFloat(gapRaw||'0');if(!Number.isFinite(gap))gap=0;var minWidth=contW+segW+gap;while(track.scrollWidth<minWidth){var clone=seg.cloneNode(true);try{clone.setAttribute('aria-hidden','true')}catch(e0){}track.appendChild(clone)}var dist=segW+gap;el.style.setProperty('--bundle-app-announcement-marquee-distance',String(dist)+'px');var dur=clampNum(banner&&banner.motionDurationSec,1,20,8);el.style.setProperty('--bundle-app-announcement-marquee-duration',String(dur)+'s')}catch(e){}}",
  "function mountBannerEl(banner){var el=document.getElementById('bundle-app-announcement');if(!el){el=document.createElement('div');el.id='bundle-app-announcement'}var rtl=isRtl();var ar=isArabic();var marquee=Boolean(banner&&banner.motionEnabled===true);var radius=clampNum(banner&&banner.shapeRadiusPx,0,40,0);var skew=clampNum(banner&&banner.shapeSkewDeg,-12,12,0);var enter=String((banner&&banner.enterAnimation)||'none');var ctaEnabled=Boolean(banner&&banner.ctaEnabled===true);var ctaText=banner&&banner.ctaText!=null?String(banner.ctaText):'';var ctaHref=safeHref(banner&&banner.ctaHref);var ctaVariant=String((banner&&banner.ctaVariant)||'solid');var ctaAnim=String((banner&&banner.ctaAnimation)||'none');var cls='bundle-app-announcement'+(banner&&banner.sticky===false?' is-not-sticky':'')+(rtl?' is-rtl':'')+(ar?' is-ar':'')+(banner&&banner.selectable===false?' is-not-selectable':'')+(marquee?' is-marquee':'')+(Math.abs(skew)>0.01?' is-skewed':'')+(enter&&enter!=='none'?' is-enter-'+enter:'');el.className=cls;var bg=banner&&banner.backgroundColor?String(banner.backgroundColor):'';var tc=banner&&banner.textColor?String(banner.textColor):'';var lc=banner&&banner.linkColor?String(banner.linkColor):'';var ac=banner&&banner.accentColor?String(banner.accentColor):'';var ff=banner&&banner.fontFamily!=null?String(banner.fontFamily):'';el.style.background=bg||'';el.style.color=tc||'';el.style.setProperty('--bundle-app-announcement-link',lc||'');el.style.setProperty('--bundle-app-announcement-accent',ac||'');el.style.setProperty('--bundle-app-announcement-radius',String(radius)+'px');el.style.setProperty('--bundle-app-announcement-skew',String(skew)+'deg');if(ff&&ff.trim()){el.style.fontFamily=ff.trim()}else{try{el.style.removeProperty('font-family')}catch(e1){}}var seg=segmentHtml(banner);var html='<div class=\"bundle-app-announcement__layout\">';if(marquee){html+='<div class=\"bundle-app-announcement__marquee\"><div class=\"bundle-app-announcement__track\">';html+='<div class=\"bundle-app-announcement__segment\">'+seg+'</div>';html+='<div class=\"bundle-app-announcement__segment\" aria-hidden=\"true\">'+seg+'</div>';html+='</div></div>'}else{html+='<div class=\"bundle-app-announcement__inner\">'+seg+'</div>'}if(ctaEnabled&&ctaHref&&ctaText&&ctaText.trim()){var ccls='bundle-app-announcement__cta'+(ctaVariant==='outline'?' is-cta-outline':'')+(ctaAnim&&ctaAnim!=='none'?' is-cta-'+ctaAnim:'');html+='<a class=\"'+ccls+'\" href=\"'+escHtml(ctaHref)+'\" rel=\"noopener noreferrer\">'+escHtml(ctaText)+'</a>'}html+='</div>';if(banner&&banner.dismissible!==false){html+='<button class=\"bundle-app-announcement__close\" type=\"button\" aria-label=\"إغلاق\">×</button>'}el.innerHTML=html;el.onclick=function(e){try{var t=e&&e.target;if(!t)return;if(t.classList&&t.classList.contains('bundle-app-announcement__close')){setDismissed(banner);removeBanner()}}catch(x){}};return el}",
  "async function loadAndRender(){try{var page=isCartLikePage()?'cart':'all';var u=buildUrl('/api/proxy/announcement-banner',{page:page});if(!u)return;var res=await fetchJson(u);var banner=res&&res.banner?res.banner:null;if(!banner||String(banner.status||'')!=='active'){removeBanner();return}if(String(banner.showOn||'all')==='cart'&&!isCartLikePage()){removeBanner();return}if(isDismissed(banner)){removeBanner();return}var el=mountBannerEl(banner);if(document.body){if(!el.parentNode){document.body.insertBefore(el,document.body.firstChild)}else if(el.parentNode!==document.body){try{el.parentNode.removeChild(el)}catch(e0){}document.body.insertBefore(el,document.body.firstChild)}if(banner&&banner.motionEnabled===true){try{requestAnimationFrame(function(){setupMarquee(el,banner)})}catch(e1){setTimeout(function(){setupMarquee(el,banner)},0)}}}}catch(e){warn('announcement-banner: failed',e&&((e.details)||e.message||e))}}",
  "function initOnce(){var inited=false;function start(){if(inited)return;inited=true;loadAndRender()}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',start)}else{start()}}",
  "initOnce();",
  "})();"
];
