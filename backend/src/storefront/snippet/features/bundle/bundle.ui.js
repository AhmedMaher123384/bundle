module.exports = [
  'var scriptSrc=(document.currentScript&&document.currentScript.src)||"";',
  "if(!scriptSrc){try{var ss=document.getElementsByTagName(\"script\");for(var i=0;i<ss.length;i++){var s=ss[i];var src=(s&&s.src)||\"\";if(!src)continue;if(src.indexOf(\"/api/storefront/snippet.js\")!==-1&&src.indexOf(\"merchantId=\"+encodeURIComponent(merchantId))!==-1){scriptSrc=src;break}}}catch(e){}}",
  "function findVariantId(){try{var url=new URL(window.location.href);var fromUrl=url.searchParams.get(\"variant_id\")||url.searchParams.get(\"variantId\")||url.searchParams.get(\"variant\")||\"\";if(fromUrl)return String(fromUrl).trim();var el=document.querySelector('[name=\"variant_id\"],[name=\"variantId\"],[data-variant-id],input[name=\"variant_id\"],select[name=\"variant_id\"]');if(el){var v=el.getAttribute(\"data-variant-id\")||el.value||\"\";v=String(v).trim();if(v)return v}var any=document.querySelector(\"[data-variant-id]\");if(any){var a=String(any.getAttribute(\"data-variant-id\")||\"\").trim();if(a)return a}return\"\"}catch(e){return\"\"}}",
  "function findProductId(){try{var path=String(window.location.pathname||\"\");var m=path.match(/\\/p(\\d+)(?:[/?#]|$)/);if(m&&m[1])return String(m[1]);var el=document.querySelector(\"[data-product-id],input[name=\\\"product_id\\\"],input[name=\\\"productId\\\"]\");if(el){var v=el.getAttribute(\"data-product-id\")||el.value||\"\";v=String(v).trim();if(v)return v}return\"\"}catch(e){return\"\"}}",
  "function openPickerModal(titleHtml,bodyHtml){var resolver=null;var wait=new Promise(function(r){resolver=r});var overlay=document.createElement(\"div\");overlay.id=\"bundle-app-modal\";overlay.style.position=\"fixed\";overlay.style.inset=\"0\";overlay.style.background=\"rgba(0,0,0,.45)\";overlay.style.zIndex=\"100000\";overlay.style.display=\"flex\";overlay.style.alignItems=\"center\";overlay.style.justifyContent=\"center\";overlay.style.padding=\"16px\";var card=document.createElement(\"div\");card.style.width=\"min(520px,100%)\";card.style.maxHeight=\"80vh\";card.style.overflow=\"auto\";card.style.background=\"#fff\";card.style.borderRadius=\"14px\";card.style.boxShadow=\"0 12px 40px rgba(0,0,0,.25)\";card.style.padding=\"12px\";card.innerHTML='<div style=\"display:flex;align-items:center;justify-content:space-between;gap:10px\"><div style=\"font-weight:900;font-size:14px\">'+titleHtml+'</div><button type=\"button\" data-action=\"close\" style=\"border:0;background:transparent;font-size:18px;line-height:1;cursor:pointer\">×</button></div><div style=\"margin-top:10px\">'+bodyHtml+'</div>';overlay.appendChild(card);function close(val){try{overlay.remove()}catch(e){}if(resolver){var r=resolver;resolver=null;r(val)}}overlay.addEventListener(\"click\",function(e){if(e.target===overlay)close(null)});var closeBtn=card.querySelector('button[data-action=\"close\"]');if(closeBtn)closeBtn.onclick=function(){close(null)};document.body.appendChild(overlay);return {overlay:overlay,card:card,close:close,wait:wait}}",
  "async function resolveProductRefItems(items,bundleId){var bid=String(bundleId||\"\").trim();var pre=(bid&&variantSelectionsByBundleId[bid]&&typeof variantSelectionsByBundleId[bid]===\"object\")?variantSelectionsByBundleId[bid]:null;var arr=Array.isArray(items)?items:[];var needs=[];var fixed=[];for(var i=0;i<arr.length;i++){var it=arr[i]||{};var v=String(it.variantId||\"\").trim();var qty=Math.max(1,Math.floor(Number(it.quantity||1)));var pid=String(it.productId||\"\").trim();if(isProductRef(v)){if(!pid)return null;needs.push({productId:pid,quantity:qty})}else{if(!v)continue;fixed.push({variantId:v,productId:pid||null,quantity:qty})}}if(!needs.length)return fixed;var units=[];var uniqPid={};for(var j=0;j<needs.length;j++){var n=needs[j];var pid2=String(n.productId);uniqPid[pid2]=true;for(var u=0;u<Number(n.quantity||0);u++){units.push({productId:pid2,key:pid2+\":\"+u})}}var pidList=Object.keys(uniqPid);var varsByPid={};for(var p=0;p<pidList.length;p++){var pid3=pidList[p];var vars=await getCachedVariants(pid3);varsByPid[pid3]=Array.isArray(vars)?vars:[];if(!varsByPid[pid3].length){varsByPid[pid3]=[{variantId:('product:'+pid3),productId:pid3,cartProductId:pid3,cartOptions:null,isActive:true,name:null,attributes:{},imageUrl:null,price:null}]}}var selectedByKey={};var pending=[];for(var k=0;k<units.length;k++){var unit=units[k];var vlist=(varsByPid[unit.productId]||[]).filter(function(x){return x&&x.isActive===true&&String(x.variantId||\"\").trim()});var preVal=pre?String(pre[unit.key]||\"\").trim():\"\";if(preVal){var ok=false;for(var z=0;z<vlist.length;z++){if(String(vlist[z]&&vlist[z].variantId||\"\").trim()===preVal){ok=true;break}}if(ok){selectedByKey[unit.key]=preVal;continue}}if(vlist.length===1){selectedByKey[unit.key]=String(vlist[0].variantId||\"\").trim()}else{pending.push(unit)}}if(pending.length){var body='';for(var x=0;x<pending.length;x++){var un=pending[x];var opts=(varsByPid[un.productId]||[]).filter(function(y){return y&&y.isActive===true&&String(y.variantId||\"\").trim()});if(!opts.length)continue;body+='<div style=\"margin-bottom:16px\"><div style=\"margin-bottom:6px;font-weight:600\">'+escHtml('اختر فاريانت للمنتج')+'</div><div style=\"display:flex;flex-wrap:wrap;gap:6px\">';for(var y=0;y<opts.length;y++){var o=opts[y];var img=o.imageUrl?'<img src=\"'+escHtml(o.imageUrl)+'\" style=\"width:32px;height:32px;border-radius:4px;margin-left:6px\">':'';body+='<button type=\"button\" data-action=\"pick-variant\" data-unit-key=\"'+escHtml(un.key)+'\" data-variant-id=\"'+escHtml(String(o.variantId||\"\").trim())+'\" style=\"display:flex;align-items:center;padding:6px 10px;border:1px solid #e5e7eb;border-radius:6px;background:#fff;cursor:pointer;font-size:13px\">'+img+'<span>'+escHtml(variantLabel(o))+'</span></button>'}body+='</div></div>'}var modal=await openPickerModal('اختيار الفاريانتات',body);if(!modal)return null;var picked={};await modal.wait;var btns=modal.card.querySelectorAll('button[data-action=\"pick-variant\"]');for(var b=0;b<btns.length;b++){var btn=btns[b];var k=String(btn.getAttribute('data-unit-key')||\"\").trim();var v=String(btn.getAttribute('data-variant-id')||\"\").trim();if(k&&v&&btn.classList.contains('is-selected'))picked[k]=v}for(var key in picked){if(!Object.prototype.hasOwnProperty.call(picked,key))continue;selectedByKey[key]=picked[key]}}var out=fixed.slice();for(var key2 in selectedByKey){if(!Object.prototype.hasOwnProperty.call(selectedByKey,key2))continue;var vid=String(selectedByKey[key2]||\"\").trim();if(!vid)continue;var meta=null;for(var pidKey in varsByPid){if(!Object.prototype.hasOwnProperty.call(varsByPid,pidKey))continue;var list=varsByPid[pidKey]||[];for(var li=0;li<list.length;li++){var item=list[li];if(item&&String(item.variantId||\"\").trim()===vid){meta=item;break}}if(meta)break}if(!meta)continue;out.push({variantId:vid,productId:meta.productId,cartProductId:meta.cartProductId,cartOptions:meta.cartOptions,quantity:1})}return out}",
  "function applySelectionsToContainer(container,bundleId){try{if(!container)return;var bid=String(bundleId||\"\").trim();if(!bid)return;var rows=container.querySelectorAll('[data-unit-key-row]');for(var i=0;i<rows.length;i++){var row=rows[i];var key=String(row.getAttribute('data-unit-key-row')||\"\").trim();if(!key)continue;var btns=row.querySelectorAll('button[data-action=\"pick-variant\"][data-variant-id]');for(var j=0;j<btns.length;j++){var b=btns[j];var vid=String(b.getAttribute('data-variant-id')||\"\").trim();var on=Boolean(val&&vid&&val===vid);if(on){b.classList.add('is-selected');b.setAttribute('aria-pressed','true')}else{b.classList.remove('is-selected');b.setAttribute('aria-pressed','false')}}}}catch(e){}}",
  "function updatePickerStatus(container,bundleId){try{if(!container)return;var bid=String(bundleId||\"\").trim();if(!bid)return;var rows=container.querySelectorAll('[data-unit-key-row]');var total=rows.length;var chosen=0;for(var i=0;i<rows.length;i++){var key=String(rows[i].getAttribute('data-unit-key-row')||\"\").trim();if(!key)continue;var v=String(sel[key]||\"\").trim();if(v)chosen++}var el=container.querySelector('[data-role=\"picker-status\"]');if(el)el.textContent=total?('تم اختيار '+fmtNum(chosen)+' من '+fmtNum(total)):''}catch(e){}}",
  "function bindPickerContainer(container,bundleId){try{if(!container)return;var bid=String(bundleId||\"\").trim();if(!bid)return;container.onclick=function(e){var t=e&&e.target;while(t&&t!==container){if(t&&t.getAttribute&&t.getAttribute('data-action')==='pick-variant')break;t=t.parentNode}if(!t||t===container)return;var key=String(t.getAttribute('data-unit-key')||\"\").trim();var val=String(t.getAttribute('data-variant-id')||\"\").trim();if(!key||!val)return;var sel=getBundleVariantSelectionMap(bid);if(!sel)return;sel[key]=val;applySelectionsToContainer(container,bid);updatePickerStatus(container,bid)};applySelectionsToContainer(container,bid);updatePickerStatus(container,bid)}catch(e){}}",
  "async function ensureVariantPickersForCard(card,bundle){try{if(!card||!bundle)return;ensurePickerStyles();var bid=String(card.getAttribute('data-bundle-id')||\"\").trim();if(!bid)return;var container=card.querySelector('.bundle-app-pickers[data-bundle-id]');if(!container)return;var sig=bundleVariantSig(bundle);var cached=variantPickerCacheByBundleId[bid];if(cached&&cached.sig===sig&&cached.html!=null){container.innerHTML=cached.html;bindPickerContainer(container,bid);return}var pending=variantPickerPendingByBundleId[bid];if(pending&&pending.sig===sig&&pending.promise)return;container.innerHTML='<div class=\"bundle-app-picker-hint\">جاري تحميل الفاريانت...</div>';var promise=(async function(){var units=bundleVariantUnits(bundle);var sel=getBundleVariantSelectionMap(bid);if(!units.length){variantPickerCacheByBundleId[bid]={sig:sig,html:\"\"};container.innerHTML='';return}pruneBundleSelections(sel,units);var uniq={};for(var i=0;i<units.length;i++){uniq[String(units[i].productId)]=true}var pids=Object.keys(uniq);var lists=await Promise.all(pids.map(function(pid){return getCachedVariants(pid)}));var varsByPid={};for(var j=0;j<pids.length;j++){var pid=pids[j];var list=Array.isArray(lists[j])?lists[j]:[];list=list.filter(function(x){return x&&x.isActive===true&&String(x.variantId||\"\").trim()});if(!list.length){list=[{variantId:('product:'+pid),productId:pid,cartProductId:pid,cartOptions:null,isActive:true,name:null,attributes:{},imageUrl:null,price:null}]}varsByPid[pid]=list}var need=[];for(var k=0;k<units.length;k++){var unit=units[k];var list2=varsByPid[unit.productId]||[];if(list2.length===1){var only=list2[0]||{};var vid=String(only.variantId||\"\").trim();if(vid)sel[unit.key]=vid}else if(list2.length>1){need.push(unit)}}if(!need.length){variantPickerCacheByBundleId[bid]={sig:sig,html:\"\"};container.innerHTML='';return}var html='<div class=\"bundle-app-pickers-title\">اختيار الفاريانت للكميات</div><div class=\"bundle-app-picker-status\" data-role=\"picker-status\">جاري التحميل...</div>';for(var m=0;m<need.length;m++){var un=need[m];var opts=(varsByPid[un.productId]||[]).filter(function(y){return y&&y.isActive===true&&String(y.variantId||\"\").trim()});if(!opts.length)continue;html+='<div style=\"margin-bottom:16px\"><div style=\"margin-bottom:6px;font-weight:600\">'+escHtml('اختر فاريانت')+'</div><div style=\"display:flex;flex-wrap:wrap;gap:6px\" data-unit-key-row=\"'+escHtml(un.key)+'\">';for(var n=0;n<opts.length;n++){var o=opts[n];var img=o.imageUrl?'<img src=\"'+escHtml(o.imageUrl)+'\" style=\"width:32px;height:32px;border-radius:4px;margin-left:6px\">':'';var on=String(sel[un.key]||\"\").trim()===String(o.variantId||\"\").trim();html+='<button type=\"button\" data-action=\"pick-variant\" data-unit-key=\"'+escHtml(un.key)+'\" data-variant-id=\"'+escHtml(String(o.variantId||\"\").trim())+'\" class=\"'+(on?'is-selected':'')+'\" style=\"display:flex;align-items:center;padding:6px 10px;border:1px solid #e5e7eb;border-radius:6px;background:#fff;cursor:pointer;font-size:13px\">'+img+'<span>'+escHtml(variantLabel(o))+'</span></button>'}html+='</div></div>'}variantPickerCacheByBundleId[bid]={sig:sig,html:html};container.innerHTML=html;bindPickerContainer(container,bid)})();variantPickerPendingByBundleId[bid]={sig:sig,promise:promise};try{await promise}catch(e){}delete variantPickerPendingByBundleId[bid]}catch(e){}}",
  "function renderProductBanners(bundles){ensureStyles();ensureTraditionalStyles();var id=\"bundle-app-banner\";var root=document.getElementById(id);if(!root){root=document.createElement(\"div\");root.id=id}mountBanner(root);var arr=Array.isArray(bundles)?bundles:[];if(!arr.length){clearProductBanner();return}var trigger=String(arr[0]&&arr[0].triggerProductId||\"\");lastTriggerProductId=trigger||lastTriggerProductId;if(selectedBundleId){var ok=false;for(var z0=0;z0<arr.length;z0++){if(String(arr[z0]&&arr[z0].id||\"\")===String(selectedBundleId||\"\")){ok=true;break}}if(!ok)selectedBundleId=null}var html='';for(var i=0;i<arr.length;i++){var b=arr[i]||{};var bid=String(b.id||\"\");var color=String(b.bannerColor||\"#0ea5e9\");var textColor=String(b.textColor||\"#ffffff\");var title=normalizeTitle(b.title);var subtitle=String(b.subtitle||\"\");var label=String(b.label||\"\");var labelSub=String(b.labelSub||\"\");var labelBg=String(b.labelBgColor||b.badgeColor||\"\");var labelText=String(b.labelTextColor||textColor||\"\");var ctaBg=String(b.ctaBgColor||\"\");var ctaText=String(b.ctaTextColor||\"\");var showItems=(b&&b.showItems===false)?false:true;var showPrice=(b&&b.showPrice===false)?false:true;var showTiers=(b&&b.showTiers===false)?false:true;var selectedMinQty=pickMinQty(b);var items=normalizeItems(b);var itemsText=(showItems&&items.length)?buildItemsText(items):'';var priceText=showPrice?buildPriceText(b):'';var tiersHtml=showTiers?buildTierRows(b,bid,selectedMinQty):'';var msg=String(messageByBundleId[bid]||\"\");var checked=bid===String(selectedBundleId||\"\");var cls='bundle-app-card'+(checked?' bundle-app-card--selected':'');var btnLabel=String(b.cta||\"أضف الباقة\");if(tiersHtml){btnLabel=btnLabel+' ('+fmtNum(Math.max(getPageQty(),Math.max(minRequiredBaseQty(b),selectedMinQty)))+' قطع)'}var cardStyle='background:'+escHtml(color)+';color:'+escHtml(textColor)+';';var btnStyle='';if(ctaBg)btnStyle+='background:'+escHtml(ctaBg)+';';if(ctaText)btnStyle+='color:'+escHtml(ctaText)+';';var labelStyle='';if(labelBg)labelStyle+='background:'+escHtml(labelBg)+';';else labelStyle+='background:rgba(255,255,255,.18);';if(labelText)labelStyle+='color:'+escHtml(labelText)+';';html+='<div class=\"'+cls+'\" style=\"'+cardStyle+'\" data-bundle-id=\"'+escHtml(bid)+'\"><div class=\"bundle-app-traditional\"><div class=\"bundle-app-header\"><div class=\"bundle-app-title-section\"><div class=\"bundle-app-title\">'+escHtml(title)+'</div>'+(subtitle?('<div class=\"bundle-app-subtitle\">'+escHtml(subtitle)+'</div>'):'')+(labelSub?('<div class=\"bundle-app-label-sub\">'+escHtml(labelSub)+'</div>'):'')+'</div>'+(label?('<div class=\"bundle-app-label\" style=\"'+labelStyle+'\">'+escHtml(label)+'</div>'):'')+'</div>'+(itemsText?('<div class=\"bundle-app-items-summary\">'+escHtml(itemsText)+'</div>'):'')+'<div class=\"bundle-app-products-section\">';if(items&&items.length){for(var j=0;j<items.length;j++){var item=items[j]||{};var itemChecked=checked;html+='<div class=\"bundle-app-product-item\" data-item-index=\"'+j+'\"><div class=\"bundle-app-product-header\"><label class=\"bundle-app-product-checkwrap\"><input class=\"bundle-app-product-check\" type=\"checkbox\" data-bundle-id=\"'+escHtml(bid)+'\" data-item-index=\"'+j+'\" '+(itemChecked?'checked':'')+' /><span class=\"bundle-app-checkmark\"></span></label><div class=\"bundle-app-product-info\"><div class=\"bundle-app-product-name\">منتج '+(j+1)+'</div><div class=\"bundle-app-product-qty\">الكمية: '+fmtNum(item.quantity||1)+'</div></div></div><div class=\"bundle-app-product-variants\" data-bundle-id=\"'+escHtml(bid)+'\" data-item-index=\"'+j+'\"></div></div>'}}html+='</div>'+(priceText?('<div class=\"bundle-app-price\">'+escHtml(priceText)+'</div>'):'')+(tiersHtml?('<div class=\"bundle-app-tiers\">'+tiersHtml+'</div>'):'')+(msg?('<div class=\"bundle-app-msg\">'+escHtml(msg)+'</div>'):'')+'<div class=\"bundle-app-footer\"><button class=\"bundle-app-btn\" type=\"button\" data-action=\"apply-one\" data-bundle-id=\"'+escHtml(bid)+'\" '+(applying?'disabled':'')+(btnStyle?(' style=\"'+btnStyle+'\"'):'')+'>'+escHtml(btnLabel)+'</button></div></div></div>'}root.innerHTML=html;var tierEls=root.querySelectorAll('.bundle-app-tier[data-tier-minqty][data-bundle-id]');for(var t=0;t<tierEls.length;t++){(function(el){el.onclick=function(){var bid=String(el.getAttribute('data-bundle-id')||\"\");var mq=Number(el.getAttribute('data-tier-minqty'));if(bid&&Number.isFinite(mq)&&mq>=1){selectedTierByBundleId[bid]=Math.floor(mq);messageByBundleId[bid]='';renderProductBanners(arr)}}})(tierEls[t])}var productChecks=root.querySelectorAll('input.bundle-app-product-check[data-bundle-id][data-item-index]');for(var c=0;c<productChecks.length;c++){(function(el){el.onchange=function(){var bid=String(el.getAttribute('data-bundle-id')||\"\");var itemIndex=String(el.getAttribute('data-item-index')||\"\");if(!bid||itemIndex===\"\")return;if(el.checked){selectedBundleId=bid;messageByBundleId[bid]='';var otherChecks=root.querySelectorAll('input.bundle-app-product-check[data-bundle-id]:not([data-bundle-id=\"'+bid+'\"])');for(var o=0;o<otherChecks.length;o++){otherChecks[o].checked=false}var sameBundleChecks=root.querySelectorAll('input.bundle-app-product-check[data-bundle-id=\"'+bid+'\"]');for(var s=0;s<sameBundleChecks.length;s++){sameBundleChecks[s].checked=true}}else{var bundleChecks=root.querySelectorAll('input.bundle-app-product-check[data-bundle-id=\"'+bid+'\"]');var anyChecked=false;for(var b=0;b<bundleChecks.length;b++){if(bundleChecks[b].checked){anyChecked=true;break}}if(!anyChecked&&String(selectedBundleId||\"\")===bid){selectedBundleId=null}}renderProductBanners(arr)}})(productChecks[c])}var btns=root.querySelectorAll('button.bundle-app-btn[data-action=\"apply-one\"][data-bundle-id]');for(var k=0;k<btns.length;k++){(function(btn){btn.onclick=function(){var bid=String(btn.getAttribute('data-bundle-id')||\"\");if(!bid||applying)return;var bundleChecks=root.querySelectorAll('input.bundle-app-product-check[data-bundle-id=\"'+bid+'\"]');var anyChecked=false;for(var b=0;b<bundleChecks.length;b++){if(bundleChecks[b].checked){anyChecked=true;break}}if(!anyChecked){messageByBundleId[bid]='يرجى اختيار منتج واحد على الأقل من الباقة';renderProductBanners(arr);return}selectedBundleId=bid;var bundle=null;for(var i=0;i<arr.length;i++){if(String(arr[i]&&arr[i].id||\"\")===bid){bundle=arr[i];break}}if(!bundle)return;applyBundleSelection(bundle)}})(btns[k])}if(selectedBundleId){var selCard=null;var cards=root.querySelectorAll('.bundle-app-card[data-bundle-id]');for(var ci=0;ci<cards.length;ci++){var c0=cards[ci];if(String(c0.getAttribute('data-bundle-id')||\"\")===String(selectedBundleId||\"\")){selCard=c0;break}}var selBundle=null;for(var s0=0;s0<arr.length;s0++){if(String(arr[s0]&&arr[s0].id||\"\")===String(selectedBundleId||\"\")){selBundle=arr[s0];break}}if(selCard&&selBundle){ensureVariantPickersForTraditionalCard(selCard,selBundle)}}}",
  "function ensureVariantPickersForTraditionalCard(card,bundle){try{if(!card||!bundle)return;ensurePickerStyles();var bid=String(card.getAttribute('data-bundle-id')||\"\").trim();if(!bid)return;var variantContainers=card.querySelectorAll('.bundle-app-product-variants[data-bundle-id][data-item-index]');var units=bundleVariantUnits(bundle);var sel=getBundleVariantSelectionMap(bid);if(!units.length){for(var v=0;v<variantContainers.length;v++){variantContainers[v].innerHTML=''}return}pruneBundleSelections(sel,units);var unitsByItem={};for(var i=0;i<units.length;i++){var unit=units[i];var itemIndex=Math.floor(i);if(!unitsByItem[itemIndex])unitsByItem[itemIndex]=[];unitsByItem[itemIndex].push(unit)}for(var j=0;j<variantContainers.length;j++){var container=variantContainers[j];var itemIndex=String(container.getAttribute('data-item-index')||\"\");var itemUnits=unitsByItem[itemIndex]||[];if(!itemUnits.length){container.innerHTML='';continue}var itemHtml='<div class=\"bundle-app-pickers-title\">اختيار الفاريانت</div>';for(var k=0;k<itemUnits.length;k++){var unit=itemUnits[k];var productId=unit.productId;var unitKey=unit.key;(function(cont,pid,key){getCachedVariants(pid).then(function(variants){if(!variants||!variants.length){cont.innerHTML='';return}var selectedVariantId=sel[key]||'';var variantHtml='<div class=\"bundle-app-variant-row\" data-unit-key-row=\"'+escHtml(key)+'\"><div style=\"display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px\">';for(var v=0;v<variants.length;v++){var variant=variants[v];if(!variant||!variant.isActive)continue;var variantId=String(variant.variantId||\"\").trim();var isSelected=selectedVariantId===variantId;variantHtml+='<button type=\"button\" data-action=\"pick-variant\" data-unit-key=\"'+escHtml(key)+'\" data-variant-id=\"'+escHtml(variantId)+'\" class=\"bundle-app-variant-btn'+(isSelected?' is-selected':'')+'\" aria-pressed=\"'+(isSelected?'true':'false')+'\" style=\"display:flex;align-items:center;padding:6px 10px;border:1px solid rgba(255,255,255,0.3);border-radius:6px;background:rgba(255,255,255,0.1);cursor:pointer;font-size:13px;color:inherit;transition:all 0.2s ease\">';if(variant.imageUrl){variantHtml+='<img src=\"'+escHtml(variant.imageUrl)+'\" alt=\"\" style=\"width:32px;height:32px;border-radius:4px;margin-left:8px;\">'}variantHtml+='<span>'+escHtml(variantLabel(variant))+'</span></button>'}variantHtml+='</div></div>';cont.innerHTML=itemHtml+variantHtml;bindPickerContainer(cont,bid)})})(container,productId,unitKey)}}}catch(e){console.error('Error in ensureVariantPickersForTraditionalCard:',e)}}",
  "function clearProductBanner(){var root=document.getElementById(\"bundle-app-banner\");if(root)root.remove()}",
  "function mountBanner(root){try{if(!root)return;if(root.getAttribute&&root.getAttribute('data-mounted')==='1')return;var container=document.querySelector('.bundle-app-container[data-feature-location=\"product\"]');if(!container){container=document.createElement('div');container.className='bundle-app-container';container.setAttribute('data-feature-location','product');var anchors=[\"form[action*='cart']\",\"form[action*='checkout']\",\".product-form\",\"[data-product-form]\",\"[data-add-to-cart]\",\"button[type='submit'][name='add-to-cart']\",\"button[type='submit']\"];var host=null;for(var i=0;i<anchors.length;i++){var el=document.querySelector(anchors[i]);if(el){host=el;break}}if(host&&host.parentNode){host.parentNode.insertBefore(container,host)}else{(document.body||document.documentElement).appendChild(container)}}if(root.parentNode!==container)container.appendChild(root);container.style.display='block';root.setAttribute('data-mounted','1')}catch(e){}}",
  "function findVariantId(){try{var p=window.salla&&window.salla.config&&window.salla.config.product?window.salla.config.product:null;var v=p&&(p.variantId||p.variant_id||p.selectedVariantId||p.selected_variant_id||p.currentVariantId);v=String(v||\"\").trim();if(v)return v;var url=new URL(window.location.href);var fromUrl=url.searchParams.get(\"variant_id\")||url.searchParams.get(\"variantId\")||url.searchParams.get(\"variant\")||\"\";if(fromUrl)return String(fromUrl).trim();var el=document.querySelector('[name=\"variant_id\"],[name=\"variantId\"],[data-variant-id],input[name=\"variant_id\"],select[name=\"variant_id\"]');if(el){var vv=el.getAttribute(\"data-variant-id\")||el.value||\"\";vv=String(vv).trim();if(vv)return vv}var any=document.querySelector(\"[data-variant-id]\");if(any){var a=String(any.getAttribute(\"data-variant-id\")||\"\").trim();if(a)return a}return\"\"}catch(e){return\"\"}}",
  "function findProductId(){try{var p=window.salla&&window.salla.config&&window.salla.config.product?window.salla.config.product:null;var pid=p&&(p.id||p.productId||p.product_id);pid=String(pid||\"\").trim();if(pid)return pid;var path=String(window.location.pathname||\"\");var m=path.match(/\\/p(\\d+)(?:[/?#]|$)/)||path.match(/\\/(?:products?|product)\\/(\\d+)(?:[/?#]|$)/)||path.match(/\\/(?:products?|product)\\/[^/?#]*?(\\d+)(?:[/?#]|$)/);if(m&&m[1])return String(m[1]);var el=document.querySelector(\"[data-product-id],input[name=\\\"product_id\\\"],input[name=\\\"productId\\\"]\");if(el){var v=el.getAttribute(\"data-product-id\")||el.value||\"\";v=String(v).trim();if(v)return v}return\"\"}catch(e){return\"\"}}",
  "function initOnce(){var inited=false;function start(){if(inited)return;inited=true;applyPendingCouponForCart();refreshProduct()}if(document.readyState===\"loading\"){document.addEventListener(\"DOMContentLoaded\",start)}else{start()}}",
];
