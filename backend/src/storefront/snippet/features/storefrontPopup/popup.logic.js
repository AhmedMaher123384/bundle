module.exports = [
  "(function(){",
  "var g=null;try{g=globalThis}catch(e){g=window}if(!g)g=window;",
  "g.BundleApp=g.BundleApp||{};",
  "var debug=false;try{debug=new URL(scriptSrc).searchParams.get(\"debug\")===\"1\"}catch(e){}",
  "function warn(){if(!debug)return;try{console.warn.apply(console,arguments)}catch(e){}}",
  "function getBackendOrigin(){try{return new URL(scriptSrc).origin}catch(e){return\"\"}}",
  "function buildUrl(path,params){var origin=getBackendOrigin();if(!origin)return null;var u=new URL(origin+path);for(var k in (params||{})){if(!Object.prototype.hasOwnProperty.call(params,k))continue;var v=params[k];if(v==null||v===\"\")continue;u.searchParams.set(k,String(v))}u.searchParams.set(\"merchantId\",merchantId);u.searchParams.set(\"token\",token);return u.toString()}",
  "async function fetchJson(url,opts){var r=await fetch(url,opts||{});var t=await r.text();var j=null;try{j=t?JSON.parse(t):null}catch(e){throw new Error(\"Invalid JSON response\")}if(!r.ok){var msg=(j&&j.message)||(\"HTTP \"+r.status);var err=new Error(msg);err.status=r.status;err.details=j;throw err}return j}",
  "function escHtml(input){var s=String(input==null?\"\":input);return s.replace(/[&<>\"']/g,function(ch){return ch===\"&\"?\"&amp;\":ch===\"<\"?\"&lt;\":ch===\">\"?\"&gt;\":ch==='\"'?\"&quot;\":\"&#39;\"})}",
  "function pageLang(){try{var el=document&&document.documentElement;var b=document&&document.body;var l=(el&&el.getAttribute&&el.getAttribute('lang'))||(b&&b.getAttribute&&b.getAttribute('lang'))||'';return String(l||'').toLowerCase()}catch(e){return ''}}",
  "function isArabic(){try{var l=pageLang();if(l&&l.indexOf('ar')===0)return true;var nl=String((navigator&&navigator.language)||'').toLowerCase();return nl&&nl.indexOf('ar')===0}catch(e){return false}}",
  "function isRtl(){try{var d=(document&&document.documentElement&&document.documentElement.dir)||'';if(d&&String(d).toLowerCase()==='rtl')return true;var bd=(document&&document.body&&document.body.dir)||'';if(bd&&String(bd).toLowerCase()==='rtl')return true;var cs=window.getComputedStyle?window.getComputedStyle(document.body||document.documentElement):null;var dir=cs&&cs.direction?String(cs.direction).toLowerCase():'';if(dir==='rtl')return true;return isArabic()}catch(e){return false}}",
  "function isCartLikePage(){try{var p=String(window.location.pathname||\"\").toLowerCase();return p.indexOf('cart')!==-1||p.indexOf('checkout')!==-1}catch(e){return false}}",
  "function isHomePage(){try{var p=String(window.location.pathname||\"\");if(!p||p==='/')return true;return p.toLowerCase()==='/home'}catch(e){return false}}",
  "function clampNum(n,min,max,def){var x=Number(n);if(!Number.isFinite(x))return def;return Math.max(min,Math.min(max,x))}",
  "function popupKey(popupId){return \"bundle_app_popup_dismissed:\"+String(merchantId||\"\")+\":\"+String(popupId||\"\")}",
  "function popupSessionKey(popupId){return \"bundle_app_popup_seen_session:\"+String(merchantId||\"\")+\":\"+String(popupId||\"\")}",
  "function isDismissed(popup){try{if(!popup||!popup.id)return false;var raw=localStorage.getItem(popupKey(popup.id));if(!raw)return false;var j=null;try{j=JSON.parse(raw)}catch(e){j=null}if(j&&typeof j==='object'){var until=Number(j.until||0);if(Number.isFinite(until)&&until>Date.now())return true;var forever=Boolean(j.forever);if(forever)return true}return raw===\"1\"}catch(e){return false}}",
  "function setDismissed(popup){try{if(!popup||!popup.id)return;var ttl=Number(popup.dismissTtlHours);if(!Number.isFinite(ttl)||ttl<0)ttl=72;var rec=null;if(ttl===0){rec={forever:true}}else{rec={until:Date.now()+ttl*60*60*1000}}localStorage.setItem(popupKey(popup.id),JSON.stringify(rec))}catch(e){}}",
  "function wasSeenThisSession(popup){try{if(!popup||!popup.id)return false;var ss=window.sessionStorage;if(!ss)return false;return ss.getItem(popupSessionKey(popup.id))==='1'}catch(e){return false}}",
  "function markSeenThisSession(popup){try{if(!popup||!popup.id)return;var ss=window.sessionStorage;if(!ss)return;ss.setItem(popupSessionKey(popup.id),'1')}catch(e){}}",
  "function removePopup(){try{var el=document.getElementById('bundle-app-popup-overlay');if(!el)return;try{if(typeof el.__bundleAppCleanup==='function')el.__bundleAppCleanup()}catch(e0){}el.remove()}catch(e){}}",
  "function normalizeEmail(s){return String(s||'').trim().toLowerCase()}",
  "function isValidEmail(email){var e=normalizeEmail(email);if(!e)return false;return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]{2,}$/.test(e)}",
  "function normalizePhone(s){var x=String(s||'').trim();x=x.replace(/[^0-9+]/g,'');return x}",
  "function isValidPhone(phone){var p=normalizePhone(phone);if(!p)return false;var digits=p.replace(/\\D/g,'');return digits.length>=7&&digits.length<=15}",
  "async function submitLead(popup,values){var u=buildUrl('/api/proxy/storefront-popup/lead');if(!u)throw new Error('Missing backend origin');return fetchJson(u,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({popupId:String(popup.id||''),name:values.name||null,email:values.email||null,phone:values.phone||null,consent:values.consent===true,pageUrl:String(window.location.href||'')})})}",
  "function createEl(tag,attrs){var el=document.createElement(tag);if(attrs){for(var k in attrs){if(!Object.prototype.hasOwnProperty.call(attrs,k))continue;var v=attrs[k];if(v==null)continue;if(k==='className')el.className=String(v);else if(k==='text')el.textContent=String(v);else if(k==='html')el.innerHTML=String(v);else el.setAttribute(k,String(v))}}return el}",
  "function mountPopupEl(popup){var rtl=isRtl();var ar=isArabic();var overlay=document.getElementById('bundle-app-popup-overlay');if(!overlay){overlay=createEl('div',{id:'bundle-app-popup-overlay',className:'bundle-app-popup-overlay'})}var layout=String((popup&&popup.layout)||'center');overlay.className='bundle-app-popup-overlay'+(layout==='bottom_left'?' is-layout-bottom_left':layout==='bottom_right'?' is-layout-bottom_right':'')+(rtl?' is-rtl':'')+(ar?' is-ar':'');var opacity=clampNum(popup&&popup.overlayOpacity,0,0.9,0.55);overlay.style.setProperty('--bundle-app-popup-overlay-alpha',String(opacity));var oc=popup&&popup.overlayColor?String(popup.overlayColor).trim():'';if(oc){overlay.style.setProperty('--bundle-app-popup-overlay-bg',oc)}else{try{overlay.style.removeProperty('--bundle-app-popup-overlay-bg')}catch(e0){}}var modal=createEl('div',{className:'bundle-app-popup'+(popup&&popup.glass===false?' is-not-glass':'')+(popup&&popup.enterAnimation&&popup.enterAnimation!=='none'?' is-enter-'+String(popup.enterAnimation):'')});modal.setAttribute('role','dialog');modal.setAttribute('aria-modal','true');var radius=clampNum(popup&&popup.shapeRadiusPx,0,40,18);var width=clampNum(popup&&popup.shapeWidthPx,280,560,420);modal.style.setProperty('--bundle-app-popup-radius',String(radius)+'px');modal.style.setProperty('--bundle-app-popup-width',String(width)+'px');var bg=popup&&popup.backgroundColor?String(popup.backgroundColor):'';var tc=popup&&popup.textColor?String(popup.textColor):'';var ac=popup&&popup.accentColor?String(popup.accentColor):'';var ff=popup&&popup.fontFamily!=null?String(popup.fontFamily):'';modal.style.background=bg||'';modal.style.color=tc||'';modal.style.setProperty('--bundle-app-popup-accent',ac||'');if(ff&&ff.trim()){modal.style.fontFamily=ff.trim()}else{try{modal.style.removeProperty('font-family')}catch(e1){}}var closeBtn=null;var dismissible=popup&&popup.dismissible!==false;var closeOnOverlay=popup&&popup.closeOnOverlay!==false;var header=createEl('div',{className:'bundle-app-popup__header'});var brand=createEl('div',{className:'bundle-app-popup__brand'});brand.innerHTML='<span class=\"bundle-app-popup__dot\"></span><span class=\"bundle-app-popup__brandtext\">'+escHtml(String(popup&&popup.name||'Bundle App'))+'</span>';header.appendChild(brand);if(dismissible){closeBtn=createEl('button',{type:'button',className:'bundle-app-popup__close',text:'×','aria-label':'Close'});header.appendChild(closeBtn)}var body=createEl('div',{className:'bundle-app-popup__body'});var title=popup&&popup.title?String(popup.title):'';var subtitle=popup&&popup.subtitle?String(popup.subtitle):'';if(title){body.appendChild(createEl('div',{className:'bundle-app-popup__title',text:title}))}if(subtitle){body.appendChild(createEl('div',{className:'bundle-app-popup__subtitle',text:subtitle}))}var imgUrl=popup&&popup.imageUrl?String(popup.imageUrl):'';if(imgUrl){var imgWrap=createEl('div',{className:'bundle-app-popup__imagewrap'});var img=createEl('img',{className:'bundle-app-popup__image',src:imgUrl,alt:''});imgWrap.appendChild(img);body.appendChild(imgWrap)}var highlights=Array.isArray(popup&&popup.highlights)?popup.highlights:[];if(highlights&&highlights.length){var ul=createEl('ul',{className:'bundle-app-popup__highlights'});for(var i=0;i<highlights.length&&i<4;i++){var h=String(highlights[i]||'').trim();if(!h)continue;var li=createEl('li',{className:'bundle-app-popup__highlight'});li.innerHTML='<span class=\"bundle-app-popup__check\"></span><span class=\"bundle-app-popup__htext\">'+escHtml(h)+'</span>';ul.appendChild(li)}if(ul.children.length)body.appendChild(ul)}var formEnabled=popup&&popup.formEnabled!==false;var fields={name:popup&&popup.fieldName!==false,email:popup&&popup.fieldEmail!==false,phone:popup&&popup.fieldPhone===true};var consentText=popup&&popup.consentText?String(popup.consentText):'';var submitText=popup&&popup.submitText?String(popup.submitText):'';var successTitle=popup&&popup.successTitle?String(popup.successTitle):'';var successMessage=popup&&popup.successMessage?String(popup.successMessage):'';var couponCode=popup&&popup.couponCode?String(popup.couponCode):'';var redirectUrl=popup&&popup.redirectUrl?String(popup.redirectUrl):'';var form=null;var successView=null;var onClose=function(){try{removePopup()}catch(e){}};function closeAndRemember(){try{var freq=String((popup&&popup.frequency)||'once_per_ttl');if(freq==='once_per_ttl')setDismissed(popup);if(freq==='once_per_session')markSeenThisSession(popup)}catch(e){}onClose()}function setError(el,msg){if(!el)return;el.textContent=String(msg||'');el.style.display=msg?'block':'none'}function toValues(){var v={name:null,email:null,phone:null,consent:false};if(form){var n=form.querySelector('input[name=\"name\"]');var e=form.querySelector('input[name=\"email\"]');var p=form.querySelector('input[name=\"phone\"]');var c=form.querySelector('input[name=\"consent\"]');if(n)v.name=String(n.value||'').trim()||null;if(e)v.email=String(e.value||'').trim()||null;if(p)v.phone=String(p.value||'').trim()||null;if(c)v.consent=c.checked===true}return v}function renderSuccess(res){try{var code=(res&&res.couponCode)?String(res.couponCode):couponCode;successView=createEl('div',{className:'bundle-app-popup__success'});if(successTitle){successView.appendChild(createEl('div',{className:'bundle-app-popup__successTitle',text:successTitle}))}else{successView.appendChild(createEl('div',{className:'bundle-app-popup__successTitle',text:ar?'تم!':'Done!'}))}if(successMessage){successView.appendChild(createEl('div',{className:'bundle-app-popup__successMsg',text:successMessage}))}else{successView.appendChild(createEl('div',{className:'bundle-app-popup__successMsg',text:ar?'شكراً، تم تسجيل بياناتك.':'Thanks! Your info was saved.'}))}if(code){var codeRow=createEl('div',{className:'bundle-app-popup__codeRow'});var codeBox=createEl('div',{className:'bundle-app-popup__code',text:code});var copy=createEl('button',{type:'button',className:'bundle-app-popup__copy',text:ar?'نسخ':'Copy'});copy.addEventListener('click',function(){try{navigator.clipboard.writeText(code)}catch(e0){}try{copy.textContent=ar?'تم النسخ':'Copied'}catch(e1){}setTimeout(function(){try{copy.textContent=ar?'نسخ':'Copy'}catch(e2){}},1400)});codeRow.appendChild(codeBox);codeRow.appendChild(copy);successView.appendChild(codeRow)}var okBtn=createEl('button',{type:'button',className:'bundle-app-popup__submit',text:ar?'إغلاق':'Close'});okBtn.addEventListener('click',closeAndRemember);successView.appendChild(okBtn);body.appendChild(successView);if(form)form.remove();if(redirectUrl&&redirectUrl.trim()){setTimeout(function(){try{window.location.assign(redirectUrl)}catch(e){}},900)}closeBtn&&closeBtn.focus&&closeBtn.focus()}catch(e){}}",
  "if(formEnabled&&(fields.name||fields.email||fields.phone)){form=createEl('form',{className:'bundle-app-popup__form'});var err=createEl('div',{className:'bundle-app-popup__error'});err.style.display='none';function addField(label,name,type,placeholder){var row=createEl('div',{className:'bundle-app-popup__field'});row.appendChild(createEl('div',{className:'bundle-app-popup__label',text:label}));var input=createEl('input',{name:name,type:type,className:'bundle-app-popup__input',placeholder:placeholder||''});row.appendChild(input);form.appendChild(row)}if(fields.name)addField(ar?'الاسم':'Name','name','text',ar?'اكتب اسمك':'Your name');if(fields.email)addField(ar?'البريد الإلكتروني':'Email','email','email',ar?'example@domain.com':'you@email.com');if(fields.phone)addField(ar?'رقم الجوال':'Phone','phone','tel',ar?'+966...':'e.g. +966...');if(consentText&&consentText.trim()){var cRow=createEl('label',{className:'bundle-app-popup__consent'});var cb=createEl('input',{type:'checkbox',name:'consent'});var ct=createEl('span',{className:'bundle-app-popup__consentText',text:consentText});cRow.appendChild(cb);cRow.appendChild(ct);form.appendChild(cRow)}form.appendChild(err);var btn=createEl('button',{type:'submit',className:'bundle-app-popup__submit',text:submitText|| (ar?'احصل على العرض':'Get offer')});form.appendChild(btn);form.addEventListener('submit',function(ev){ev.preventDefault();setError(err,'');var v=toValues();if(fields.email&&v.email&&!isValidEmail(v.email)){setError(err,ar?'البريد الإلكتروني غير صحيح':'Invalid email');return}if(fields.phone&&v.phone&&!isValidPhone(v.phone)){setError(err,ar?'رقم الجوال غير صحيح':'Invalid phone');return}if(consentText&&consentText.trim()&&v.consent!==true){setError(err,ar?'يرجى الموافقة للمتابعة':'Please accept to continue');return}btn.disabled=true;btn.textContent=ar?'جاري الإرسال...':'Sending...';submitLead(popup,v).then(function(res){try{var freq=String((popup&&popup.frequency)||'once_per_ttl');if(freq==='once_per_ttl')setDismissed(popup);if(freq==='once_per_session')markSeenThisSession(popup)}catch(e0){}renderSuccess(res)}).catch(function(e){warn('popup: lead failed',e&&((e.details)||e.message||e));btn.disabled=false;btn.textContent=submitText|| (ar?'احصل على العرض':'Get offer');setError(err,ar?'حصل خطأ. حاول مرة أخرى':'Something went wrong. Try again.')})});body.appendChild(form)}",
  "modal.appendChild(header);modal.appendChild(body);overlay.innerHTML='';overlay.appendChild(modal);function onOverlayClick(ev){try{if(!closeOnOverlay||!dismissible)return;var t=ev&&ev.target;if(t===overlay)closeAndRemember()}catch(e){}}overlay.addEventListener('click',onOverlayClick);function onKey(ev){try{if(!dismissible)return;var key=String(ev&&ev.key||'');if(key==='Escape'){ev.preventDefault();closeAndRemember()}}catch(e){}}document.addEventListener('keydown',onKey);if(closeBtn){closeBtn.addEventListener('click',closeAndRemember)}overlay.__bundleAppCleanup=function(){try{overlay.removeEventListener('click',onOverlayClick)}catch(e0){}try{document.removeEventListener('keydown',onKey)}catch(e1){}};return overlay}",
  "async function loadAndRender(){try{var page=isCartLikePage()?'cart':(isHomePage()?'home':'all');var u=buildUrl('/api/proxy/storefront-popup',{page:page});if(!u)return;var res=await fetchJson(u);var popup=res&&res.popup?res.popup:null;if(!popup||String(popup.status||'')!=='active'){removePopup();return}var freq=String((popup&&popup.frequency)||'once_per_ttl');if(freq==='once_per_ttl'&&isDismissed(popup)){removePopup();return}if(freq==='once_per_session'&&wasSeenThisSession(popup)){removePopup();return}var delay=clampNum(popup&&popup.showDelayMs,0,20000,800);setTimeout(function(){try{var existing=document.getElementById('bundle-app-popup-overlay');if(existing)return;var el=mountPopupEl(popup);if(document.body){document.body.appendChild(el);markSeenThisSession(popup)}}catch(e){warn('popup: mount failed',e&&((e.details)||e.message||e))}},delay)}catch(e){warn('storefront-popup: failed',e&&((e.details)||e.message||e))}}",
  "function initOnce(){var inited=false;function start(){if(inited)return;inited=true;loadAndRender()}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',start)}else{start()}}",
  "initOnce();",
  "})();"
];
