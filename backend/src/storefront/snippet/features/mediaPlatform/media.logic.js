module.exports = [
  "(function(){",
  "var g=null;try{g=globalThis}catch(e){g=window}if(!g)g=window;",
  "g.BundleApp=g.BundleApp||{};",
  "var debug=false;try{debug=new URL(scriptSrc).searchParams.get(\"debug\")===\"1\"}catch(e){}",
  "function warn(){if(!debug)return;try{console.warn.apply(console,arguments)}catch(e){}}",
  "function getBackendOrigin(){try{return new URL(scriptSrc).origin}catch(e){return\"\"}}",
  "function buildUrl(path,params){var origin=getBackendOrigin();if(!origin)return null;var u=new URL(origin+path);for(var k in (params||{})){if(!Object.prototype.hasOwnProperty.call(params,k))continue;var v=params[k];if(v==null||v===\"\")continue;u.searchParams.set(k,String(v))}u.searchParams.set(\"merchantId\",merchantId);u.searchParams.set(\"token\",token);return u.toString()}",
  "async function fetchJson(url,opts){var r=await fetch(url,opts||{});var t=await r.text();var j=null;try{j=t?JSON.parse(t):null}catch(e){throw new Error(\"Invalid JSON response\")}if(!r.ok){var msg=(j&&j.message)||(\"HTTP \"+r.status);var err=new Error(msg);err.status=r.status;err.details=j;throw err}return j}",
  "function postJson(url,body){return fetchJson(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body||{})})}",
  "function pageLang(){try{var el=document&&document.documentElement;var b=document&&document.body;var l=(el&&el.getAttribute&&el.getAttribute('lang'))||(b&&b.getAttribute&&b.getAttribute('lang'))||'';return String(l||'').toLowerCase()}catch(e){return ''}}",
  "function isArabic(){try{var l=pageLang();if(l&&l.indexOf('ar')===0)return true;var nl=String((navigator&&navigator.language)||'').toLowerCase();return nl&&nl.indexOf('ar')===0}catch(e){return false}}",
  "function isRtl(){try{var d=(document&&document.documentElement&&document.documentElement.dir)||'';if(d&&String(d).toLowerCase()==='rtl')return true;var bd=(document&&document.body&&document.body.dir)||'';if(bd&&String(bd).toLowerCase()==='rtl')return true;var cs=window.getComputedStyle?window.getComputedStyle(document.body||document.documentElement):null;var dir=cs&&cs.direction?String(cs.direction).toLowerCase():'';if(dir==='rtl')return true;return isArabic()}catch(e){return false}}",
  "function ensureOnce(){try{if(g.BundleApp&&g.BundleApp.__mediaPlatformMounted)return false;g.BundleApp.__mediaPlatformMounted=true;return true}catch(e){return true}}",
  "function createFab(){var btn=document.createElement('button');btn.type='button';btn.setAttribute('aria-label','Media');btn.style.position='fixed';btn.style.bottom='18px';btn.style.zIndex='100002';btn.style.border='0';btn.style.cursor='pointer';btn.style.padding='12px 14px';btn.style.borderRadius='999px';btn.style.background='#0f172a';btn.style.color='#fff';btn.style.boxShadow='0 18px 50px rgba(2,6,23,.38)';btn.style.fontWeight='900';btn.style.fontSize='13px';btn.style.letterSpacing='.2px';btn.style.display='inline-flex';btn.style.alignItems='center';btn.style.gap='10px';btn.style.userSelect='none';btn.style.webkitUserSelect='none';btn.style.transition='transform .12s ease,filter .12s ease,opacity .12s ease';btn.onmouseenter=function(){btn.style.filter='brightness(1.04)'};btn.onmouseleave=function(){btn.style.filter=''};btn.onmousedown=function(){btn.style.transform='scale(.99)'};btn.onmouseup=function(){btn.style.transform=''};if(isRtl()){btn.style.left='18px'}else{btn.style.right='18px'};var icon=document.createElement('span');icon.textContent='⬆';icon.style.fontSize='14px';icon.style.lineHeight='1';var text=document.createElement('span');text.textContent=isArabic()?'منصة الرفع':'Media';btn.appendChild(icon);btn.appendChild(text);return btn}",
  "function buildSheet(){var overlay=document.createElement('div');overlay.className='bundle-app-bottomsheet';overlay.style.alignItems='flex-end';overlay.style.justifyContent='center';overlay.style.padding='10px';overlay.style.zIndex='100003';var panel=document.createElement('div');panel.className='bundle-app-bottomsheet__panel';panel.style.width='min(760px,100%)';panel.style.maxHeight='85vh';panel.style.overflow='auto';var head=document.createElement('div');head.className='bundle-app-bottomsheet__head';var title=document.createElement('div');title.className='bundle-app-bottomsheet__title';title.textContent=isArabic()?'منصة الرفع':'Media platform';var close=document.createElement('button');close.type='button';close.textContent=isArabic()?'إغلاق':'Close';close.style.padding='6px 10px';close.style.borderRadius='10px';close.style.border='1px solid rgba(15,23,42,.12)';close.style.background='#fff';close.style.color='#0b1220';close.style.fontSize='13px';close.style.fontWeight='900';head.appendChild(title);head.appendChild(close);var body=document.createElement('div');body.style.padding='0 14px 14px';var topRow=document.createElement('div');topRow.style.display='flex';topRow.style.alignItems='center';topRow.style.justifyContent='space-between';topRow.style.gap='10px';topRow.style.flexWrap='wrap';topRow.style.padding='0 0 12px';var tabs=document.createElement('div');tabs.style.display='flex';tabs.style.gap='8px';tabs.style.flexWrap='wrap';var actions=document.createElement('div');actions.style.display='flex';actions.style.gap='8px';actions.style.flexWrap='wrap';topRow.appendChild(tabs);topRow.appendChild(actions);var uploads=document.createElement('div');uploads.style.display='none';uploads.style.flexDirection='column';uploads.style.gap='8px';uploads.style.marginBottom='10px';var content=document.createElement('div');content.style.display='flex';content.style.flexDirection='column';content.style.gap='12px';body.appendChild(topRow);body.appendChild(uploads);body.appendChild(content);panel.appendChild(head);panel.appendChild(body);overlay.appendChild(panel);return {overlay:overlay,closeBtn:close,tabs:tabs,actions:actions,uploads:uploads,content:content}}",
  "function pill(label,active){var b=document.createElement('button');b.type='button';b.textContent=label;b.style.border='1px solid rgba(15,23,42,.12)';b.style.background=active?'#0f172a':'#fff';b.style.color=active?'#fff':'#0b1220';b.style.padding='9px 12px';b.style.borderRadius='999px';b.style.fontSize='13px';b.style.fontWeight='900';b.style.cursor='pointer';b.style.boxShadow=active?'0 14px 30px rgba(2,6,23,.14)':'0 10px 24px rgba(0,0,0,.06)';return b}",
  "function btnPrimary(label){var b=document.createElement('button');b.type='button';b.textContent=label;b.style.border='0';b.style.cursor='pointer';b.style.padding='10px 12px';b.style.borderRadius='12px';b.style.background='#0f172a';b.style.color='#fff';b.style.fontWeight='900';b.style.fontSize='13px';b.style.boxShadow='0 18px 40px rgba(2,6,23,.16)';return b}",
  "function btnGhost(label){var b=document.createElement('button');b.type='button';b.textContent=label;b.style.border='1px solid rgba(15,23,42,.12)';b.style.cursor='pointer';b.style.padding='10px 12px';b.style.borderRadius='12px';b.style.background='#fff';b.style.color='#0b1220';b.style.fontWeight='900';b.style.fontSize='13px';b.style.boxShadow='0 10px 24px rgba(0,0,0,.06)';return b}",
  "function fmtBytes(n){var b=Number(n);if(!Number.isFinite(b)||b<0)return'';if(b<1024)return b+' B';var kb=b/1024;if(kb<1024)return kb.toFixed(1)+' KB';var mb=kb/1024;if(mb<1024)return mb.toFixed(1)+' MB';var gb=mb/1024;return gb.toFixed(2)+' GB'}",
  "function renderEmpty(){var wrap=document.createElement('div');wrap.style.border='1px dashed rgba(15,23,42,.18)';wrap.style.borderRadius='14px';wrap.style.padding='16px';wrap.style.background='rgba(15,23,42,.02)';wrap.style.color='rgba(15,23,42,.8)';wrap.style.fontSize='13px';wrap.style.fontWeight='900';wrap.textContent=isArabic()?'مفيش ملفات مرفوعة لحد دلوقتي.':'No media uploaded yet.';return wrap}",
  "function renderError(msg){var wrap=document.createElement('div');wrap.style.border='1px solid rgba(225,29,72,.22)';wrap.style.borderRadius='14px';wrap.style.padding='16px';wrap.style.background='rgba(225,29,72,.06)';wrap.style.color='#881337';wrap.style.fontSize='13px';wrap.style.fontWeight='900';wrap.textContent=String(msg||'Error');return wrap}",
  "function renderLoading(){var wrap=document.createElement('div');wrap.style.border='1px solid rgba(15,23,42,.10)';wrap.style.borderRadius='14px';wrap.style.padding='14px';wrap.style.background='#fff';wrap.style.color='rgba(15,23,42,.75)';wrap.style.fontSize='13px';wrap.style.fontWeight='900';wrap.textContent=isArabic()?'جاري التحميل...':'Loading...';return wrap}",
  "function renderUploadRow(rec){var row=document.createElement('div');row.style.display='flex';row.style.alignItems='center';row.style.justifyContent='space-between';row.style.gap='10px';row.style.padding='10px 12px';row.style.borderRadius='14px';row.style.border='1px solid rgba(15,23,42,.10)';row.style.background='#fff';row.style.boxShadow='0 10px 22px rgba(0,0,0,.06)';var left=document.createElement('div');left.style.minWidth='0';left.style.display='flex';left.style.flexDirection='column';left.style.gap='4px';var name=document.createElement('div');name.style.fontSize='12px';name.style.fontWeight='950';name.style.color='#0b1220';name.style.overflow='hidden';name.style.textOverflow='ellipsis';name.style.whiteSpace='nowrap';name.textContent=String(rec.name||'');var sub=document.createElement('div');sub.style.fontSize='12px';sub.style.fontWeight='900';sub.style.color=rec.status==='error'?'#881337':'rgba(15,23,42,.70)';sub.textContent=rec.status==='uploading'?(isArabic()?'جاري الرفع...':'Uploading...'):rec.status==='done'?(isArabic()?'تم الرفع':'Uploaded'):rec.status==='error'?String(rec.error||'Error'):(isArabic()?'في الانتظار':'Queued');left.appendChild(name);left.appendChild(sub);var right=document.createElement('div');right.style.display='flex';right.style.alignItems='center';right.style.gap='10px';right.style.flex='0 0 auto';var meta=document.createElement('div');meta.style.fontSize='12px';meta.style.fontWeight='900';meta.style.color='rgba(15,23,42,.70)';meta.textContent=rec.size?fmtBytes(rec.size):'';right.appendChild(meta);row.appendChild(left);row.appendChild(right);return row}",
  "function renderGrid(items){var grid=document.createElement('div');grid.style.display='grid';grid.style.gridTemplateColumns='repeat(2,minmax(0,1fr))';grid.style.gap='10px';grid.style.alignItems='stretch';grid.style.marginTop='4px';for(var i=0;i<items.length;i++){var it=items[i]||{};var card=document.createElement('div');card.style.border='1px solid rgba(15,23,42,.10)';card.style.borderRadius='14px';card.style.overflow='hidden';card.style.background='#fff';card.style.boxShadow='0 10px 22px rgba(0,0,0,.06)';var media=document.createElement('div');media.style.width='100%';media.style.aspectRatio='16 / 10';media.style.background='rgba(2,6,23,.06)';media.style.display='flex';media.style.alignItems='center';media.style.justifyContent='center';media.style.overflow='hidden';if(String(it.resourceType)==='video'){var v=document.createElement('video');v.controls=true;v.playsInline=true;v.preload='metadata';v.src=String(it.secureUrl||it.url||'');v.style.width='100%';v.style.height='100%';v.style.objectFit='cover';media.appendChild(v)}else{var img=document.createElement('img');img.alt='';img.loading='lazy';img.decoding='async';img.referrerPolicy='no-referrer';img.src=String(it.secureUrl||it.url||'');img.style.width='100%';img.style.height='100%';img.style.objectFit='cover';media.appendChild(img)};var meta=document.createElement('div');meta.style.padding='10px';meta.style.display='flex';meta.style.flexDirection='column';meta.style.gap='6px';var line1=document.createElement('div');line1.style.display='flex';line1.style.alignItems='center';line1.style.justifyContent='space-between';line1.style.gap='10px';var name=document.createElement('div');name.style.fontSize='12px';name.style.fontWeight='950';name.style.color='#0b1220';name.style.overflow='hidden';name.style.textOverflow='ellipsis';name.style.whiteSpace='nowrap';name.textContent=String(it.originalFilename||it.publicId||'');var badge=document.createElement('div');badge.style.fontSize='11px';badge.style.fontWeight='950';badge.style.padding='5px 8px';badge.style.borderRadius='999px';badge.style.background='rgba(15,23,42,.06)';badge.style.color='#0b1220';badge.textContent=String(it.resourceType||'');line1.appendChild(name);line1.appendChild(badge);var line2=document.createElement('div');line2.style.display='flex';line2.style.alignItems='center';line2.style.justifyContent='space-between';line2.style.gap='10px';line2.style.fontSize='12px';line2.style.color='rgba(15,23,42,.75)';var size=document.createElement('div');size.textContent=fmtBytes(it.bytes);var open=document.createElement('a');open.href=String(it.secureUrl||it.url||'#');open.target='_blank';open.rel='noopener noreferrer';open.textContent=isArabic()?'فتح':'Open';open.style.fontWeight='950';open.style.textDecoration='underline';line2.appendChild(size);line2.appendChild(open);meta.appendChild(line1);meta.appendChild(line2);card.appendChild(media);card.appendChild(meta);grid.appendChild(card)};return grid}",
  "async function loadAssets(resourceType,page,limit){var url=buildUrl('/api/proxy/media/assets',{resourceType:resourceType||'',page:page||1,limit:limit||24});if(!url)throw new Error('Missing backend origin');return await fetchJson(url)}",
  "async function getSignature(resourceType){var url=buildUrl('/api/proxy/media/signature',{});if(!url)throw new Error('Missing backend origin');return await postJson(url,{resourceType:resourceType||'image'})}",
  "async function recordAsset(cloud){var url=buildUrl('/api/proxy/media/assets',{});if(!url)throw new Error('Missing backend origin');return await postJson(url,{cloudinary:cloud})}",
  "async function uploadToCloudinary(file,sign){var c=sign&&sign.cloudinary?sign.cloudinary:null;if(!c||!c.uploadUrl||!c.apiKey||!c.signature||!c.timestamp||!c.folder)throw new Error('Invalid signature');var fd=new FormData();fd.append('file',file);fd.append('api_key',String(c.apiKey));fd.append('timestamp',String(c.timestamp));fd.append('signature',String(c.signature));fd.append('folder',String(c.folder));if(c.tags)fd.append('tags',String(c.tags));if(c.context)fd.append('context',String(c.context));var r=await fetch(String(c.uploadUrl),{method:'POST',body:fd});var j=await r.json().catch(function(){return null});if(!r.ok){var msg=(j&&j.error&&j.error.message)||('Upload failed');throw new Error(msg)}return j}",
  "function mount(){try{if(!ensureOnce())return;try{if(typeof ensureStyles==='function')ensureStyles()}catch(e){};var fab=createFab();var sheetEl=null;fab.onclick=function(){try{if(sheetEl)return;var sheet=buildSheet();sheetEl=sheet.overlay;var input=document.createElement('input');input.type='file';input.multiple=true;input.accept='image/*,video/*';input.style.display='none';document.body.appendChild(input);function close(){try{if(sheetEl)sheetEl.remove()}catch(e){}try{if(input&&input.remove)input.remove()}catch(e){}sheetEl=null}sheet.closeBtn.onclick=close;sheet.overlay.addEventListener('click',function(ev){try{if(ev.target===sheet.overlay)close()}catch(e){}});var state={type:'',page:1,limit:24,loading:false,items:[],total:0,error:'',uploads:[],uploading:false};function setTab(t){state.type=t||'';state.page=1;state.items=[];state.total=0;state.error='';render();fetchAndRender()}async function fetchAndRender(){if(state.loading)return;state.loading=true;render();try{var data=await loadAssets(state.type,state.page,state.limit);var items=Array.isArray(data&&data.items)?data.items:[];state.total=Number(data&&data.total||0)||0;if(state.page===1)state.items=items;else state.items=state.items.concat(items);state.loading=false;render()}catch(err){state.loading=false;state.error=String((err&&err.message)||err||'');render()}}async function runUploads(files){if(state.uploading)return;state.uploading=true;state.uploads=[];for(var i=0;i<files.length;i++){var f=files[i];if(!f)continue;state.uploads.push({name:String(f.name||''),size:Number(f.size||0)||0,status:'queued',error:''})}render();for(var j=0;j<files.length;j++){var file=files[j];if(!file)continue;var rec=state.uploads[j];try{rec.status='uploading';rec.error='';render();var rt=(String(file.type||'').indexOf('video')===0)?'video':'image';var sign=await getSignature(rt);var uploaded=await uploadToCloudinary(file,sign);await recordAsset(uploaded);rec.status='done';render()}catch(e){rec.status='error';rec.error=String((e&&e.message)||e||'Error');render()}}state.uploading=false;render();setTab(state.type)}input.onchange=function(){try{var fs=input.files?Array.prototype.slice.call(input.files):[];input.value='';if(!fs.length)return;runUploads(fs)}catch(e){}};function render(){try{sheet.tabs.innerHTML='';sheet.actions.innerHTML='';sheet.uploads.innerHTML='';sheet.content.innerHTML='';var labels=isArabic()?{all:'الكل',img:'صور',vid:'فيديو',up:'رفع ملفات',ref:'تحديث'}:{all:'All',img:'Images',vid:'Videos',up:'Upload',ref:'Refresh'};var allBtn=pill(labels.all,state.type==='');var imgBtn=pill(labels.img,state.type==='image');var vidBtn=pill(labels.vid,state.type==='video');allBtn.onclick=function(){setTab('')};imgBtn.onclick=function(){setTab('image')};vidBtn.onclick=function(){setTab('video')};sheet.tabs.appendChild(allBtn);sheet.tabs.appendChild(imgBtn);sheet.tabs.appendChild(vidBtn);var uploadBtn=btnPrimary(labels.up);uploadBtn.onclick=function(){try{input.click()}catch(e){}};var refreshBtn=btnGhost(labels.ref);refreshBtn.onclick=function(){fetchAndRender()};sheet.actions.appendChild(uploadBtn);sheet.actions.appendChild(refreshBtn);if(state.uploads.length){sheet.uploads.style.display='flex';for(var i=0;i<state.uploads.length;i++)sheet.uploads.appendChild(renderUploadRow(state.uploads[i]));}else{sheet.uploads.style.display='none'}if(state.loading&&state.page===1)sheet.content.appendChild(renderLoading());if(state.error)sheet.content.appendChild(renderError(state.error));if(!state.loading&&!state.error){if(!state.items.length)sheet.content.appendChild(renderEmpty());else sheet.content.appendChild(renderGrid(state.items));if(state.total>state.items.length){var more=btnPrimary(isArabic()?'تحميل المزيد':'Load more');more.onclick=function(){state.page+=1;fetchAndRender()};sheet.content.appendChild(more)}}}catch(e){}}document.body.appendChild(sheet.overlay);render();fetchAndRender()}catch(e){warn('media platform open failed',e);try{if(sheetEl)sheetEl.remove()}catch(x){}sheetEl=null}};document.body.appendChild(fab)}catch(e){warn('media platform mount failed',e)}}",
  "try{mount()}catch(e){}",
  "})();"
];
